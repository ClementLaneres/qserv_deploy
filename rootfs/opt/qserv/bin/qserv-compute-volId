#!/bin/sh

usage() { 
cat << EOD
Usage:`basename $0`

    -t number of first volume
    -p volume prefix
EOD
}

while getopts ":t:p:" c; do
    case $c in
        t)
            t=${OPTARG} ;;
        p)
            p=${OPTARG} ;;
        \?)
            usage ; exit ;;
    esac
done
shift $((OPTIND-1))

if [ -z "${t}" ] || [ -z "${p}" ]; then
    usage ; exit ;
fi

echo "first volume = ${t}"
echo "volume prefix = ${p}"

volume_list=`openstack volume list -c ID -c Name -f csv | grep ${p} | awk -F\, '{ print $2";"$1 }' |tr , =`
volume_list=`echo ${volume_list} | sed -e 's/\"\ \"/\",\"/g' | sed -e "s/\${p}//g" | sed -e 's/;/=/g'`
volume_list={${volume_list}}

echo $volume_list >> volume_list
