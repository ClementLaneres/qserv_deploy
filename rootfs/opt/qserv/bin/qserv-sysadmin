#!/bin/sh

# Run Qserv system management scripts

# @author  Fabrice Jammes <fabrice.jammes@clermont.in2p3.fr>
# @author  Benjamin Roziere <benjamin.roziere@clermont.in2p3.fr>

set -e

DIR=$(cd "$(dirname "$0")"; pwd -P)

usage() {
    cat << EOD
Usage: $(basename "$0") [options]
Available options:
  -C            Command to launch
  -h            This message

Run Qserv system management tools and scripts.

EOD
}

# Get the options
while getopts hC: c ; do
    case $c in
        C) CMD="${OPTARG}" ;;
        h) usage ; exit 0 ;;
        \?) usage ; exit 2 ;;
    esac
done
shift "$((OPTIND-1))"

if [ $# -ne 0 ] ; then
    usage
    exit 2
fi

if [ ! -d "$CLUSTER_CONFIG_DIR" ]; then
    echo "ERROR: incorrect CLUSTER_CONFIG_DIR parameter: \"$CLUSTER_CONFIG_DIR\""
    usage
    exit 2
fi

SYSADMIN_SCRIPTS_DIR=$QSERV_INSTALL_DIR/k8s/sysadmin

if [ -z "${CMD}" ] || [ ! -x "$SYSADMIN_SCRIPTS_DIR/${CMD}" ]; then
    echo "ERROR: Invalid command: ${CMD}"
    echo "Available commands:"
    find $SYSADMIN_SCRIPTS_DIR -type f -perm -111 -printf "%f\n"
    exit 2
fi

$SYSADMIN_SCRIPTS_DIR/${CMD}
